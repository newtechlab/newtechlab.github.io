<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>New Tech Lab - Tech Radar</title>
    <meta name="viewport" content="width=device-width">
    <meta name="viewport" content="initial-scale=1.0">
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            transform: translateZ(0);
        }

        #c {
            position: absolute;
            top: 0;
            left: 800;
            transform: translateZ(0);
        }

        .a {
            position: absolute;
            top: 0;
            left: 0;
            width: 100px;
            height: 100px;
            transform: translateZ(0);
            will-change: transform;
            transform-origin: 50% 50%;
        }
    </style>
</head>

<body>
    <div id="c"></div>
    <script>
        var regex = /[?&]([^=#]+)=([^&#]*)/g,
            url = window.location.href,
            params = {},
            match;
        while (match = regex.exec(url)) {
            params[match[1]] = match[2];
        }

        console.log(params)

        var no = params["no"] || 100;
        var svg = params["svg"] == true ? true : false



        // A small vector enabled animation library we use to get "force like" behaviour
        var animate = function (start, render, m, d) {
            start = Array.isArray(start) ? start : [start];
            m = m || 0.06;
            d = d || 7;
            var x = [start],
                v = start.map(function (d) {
                    0.0
                }),
                tx = [start];
            var draw, ct = Date.now(),
                drawing = false;
            draw = function (now) {
                drawing = true
                var now = Date.now(),
                    dt = (now - ct) / 1000.0
                ct = now
                let ok = true
                for (let i = 0; i < v.length; i++) {
                    let acc = (tx[i] - x[i]) / m
                    v[i] += acc * dt - d * v[i] * dt
                    x[i] += v[i] * dt
                    if (Math.abs(acc) < 0.001 && Math.abs(v[i]) < 0.001) {} else {
                        ok = false
                    }
                }
                render(x)
                if (ok) {
                    drawing = false
                    return
                }
                window.requestAnimationFrame(draw)
            }
            render(start)
            draw()

            return {
                update: function (target) {
                    tx = target
                    if (!drawing) {
                        ct = Date.now()
                        window.requestAnimationFrame(draw)
                    }
                }
            }
        }



        var elems = [];
        var c = document.getElementById("c")
        for (var i = 0; i < no; i++) {
            var gg = document.createElement("div")
            gg.className = "a"

            var n = document.createElement("img")
            if (svg) {
                n.src = "https://upload.wikimedia.org/wikipedia/commons/6/67/Firefox_Logo%2C_2017.svg"
            } else {
                n.src = "https://upload.wikimedia.org/wikipedia/commons/d/d2/Firefox_Logo%2C_2017.png"
            }
            n.width = "100"
            n.height = "100"

            gg.appendChild(n)
            n = document.createElement("p")
            n.innerHTML = "This is my text"
            gg.appendChild(n)

            c.appendChild(gg)

            elems.push({
                dom: gg,
                pos: [200 + Math.random() * 500, Math.random() * 500],
            })
        }

        // every 2 seconds randomize new pos where they should go
        var an
        let aa = animate([0, 0, 1, 0, 1], function (pos) {
            for (var i = 0; i < no; i++) {
                elems[i].dom.style.transform = "scale(" + pos[2] + ") rotate(" + pos[3] + "deg) translateX(" +
                    (elems[i].pos[0] + pos[0]) / pos[2] + "px) translateY(" + (elems[i].pos[1] + pos[1]) / pos[
                        2] + "px) "
                elems[i].dom.style.opacity = pos[4]
            }
        })
        an = function () {
            aa.update([Math.random() * 50, Math.random() * 50, 0.5 + 4 * Math.random(), Math.random() * 18,
                Math
                .random()
            ])
            window.setTimeout(an, 500)
        }
        an()
    </script>
</body>

</html>