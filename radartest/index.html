<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>New Tech Lab - Tech Radar</title>
    <meta name="viewport" content="width=device-width">
    <meta name="viewport" content="initial-scale=1.0">
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            transform: translateZ(0);
            overflow: hidden;
            width: 100vw;
            height: 75vh;

            font-family: JandaSafeandSound;
        }

        #c {
            position: absolute;
            top: 0vh;
            left: 0vw;
            overflow: hidden;
            transform: translateZ(0);
            width: 100vw;
            height: 75vh;

        }

        .a {
            position: fixed;
            width: 200px;
            height: 200px;
            font-size: 15px;
            transform: translateZ(0);
            will-change: transform;
            transform-origin: 50% 50%;
        }
    </style>
</head>

<body>
    <div id="c"></div>
    <script>
        function attachHandler(object, event, callback) {
            if (!object || !event || !callback) {
                return;
            }
            if (object.addEventListner) {
                object.addEventListener(event, callback);
            } else if (object.attachEvent) {
                object.attachEvent("on" + event, callback);
            } else {
                object["on" + event] = callback;
            }
        }

        var keyboardEvents = ["keydown", "keyup", "keypress"];
        var mouseEvents = ["mousedown", "mouseup", "mousemove", "mousewheel"];
        var touchEvents = ["touchstart", "touchmove", "touchend", "touchcancel", "touchforcechange"];
        var gestureEvents = ["gesturestart", "gesturechange", "gestureend"];
        var customEvents = ["scroll", "zoom", "orientationchange"];

        var events = keyboardEvents.concat(mouseEvents, touchEvents, gestureEvents, customEvents);
        events.forEach(function (e) {
            attachHandler(document, e, function (evt) {
                evt.preventDefault();
                evt.stopPropagation();
                console.log("Stopped: " + e, e.target);
                return false;
            });
        });
    </script>
    <script>
        var regex = /[?&]([^=#]+)=([^&#]*)/g,
            url = window.location.href,
            params = {},
            match;
        while (match = regex.exec(url)) {
            params[match[1]] = match[2];
        }

        let X = 0,
            Y = 0

        var no = params["no"] || 100;
        var svg = params["svg"] == true ? true : false

        // A small vector enabled animation library we use to get "force like" behaviour
        var animate = function (start, render, m, d) {
            start = Array.isArray(start) ? start : [start];
            m = m || 0.06;
            d = d || 7;
            var x = start.map(function (v) {
                    return v
                }),
                v = start.map(function (d) {
                    return 0.0
                }),
                tx = start.map(function (v) {
                    return v
                });
            var draw, ct = Date.now(),
                drawing = false;
            draw = function (now) {
                drawing = true
                var now = Date.now(),
                    dt = (now - ct) / 1000.0
                ct = now
                let ok = true
                for (let i = 0; i < v.length; i++) {
                    let acc = (tx[i] - x[i]) / m
                    v[i] += acc * dt - d * v[i] * dt
                    x[i] += v[i] * dt
                    if (Math.abs(acc) < 0.001 && Math.abs(v[i]) < 0.001) {} else {
                        ok = false
                    }
                }
                render(x)
                if (ok) {
                    drawing = false
                    return
                }
                window.requestAnimationFrame(draw)
            }
            render(start)
            draw()

            return {
                update: function (target) {
                    tx = target
                    if (!drawing) {
                        ct = Date.now()
                        window.requestAnimationFrame(draw)
                    }
                }
            }
        }



        var elems = [];
        var c = document.getElementById("c")
        for (var i = 0; i < no; i++) {
            for (var j = 0; j < 1; j++) {
                var gg = document.createElement("div")
                gg.className = "a"

                var n = document.createElement("img")
                if (svg) {
                    n.src = "https://upload.wikimedia.org/wikipedia/commons/6/67/Firefox_Logo%2C_2017.svg"
                } else {
                    n.src = "https://upload.wikimedia.org/wikipedia/commons/d/d2/Firefox_Logo%2C_2017.png"
                }
                n.width = "100"
                n.height = "100"

                gg.appendChild(n)
                n = document.createElement("p")
                n.innerHTML = "This is my text " + i
                gg.appendChild(n)

                c.appendChild(gg)
                if (j > 0) {
                    gg.style.display = "none"
                    continue
                }
                elems.push({
                    dom: gg,
                    pos: [200 + Math.random() * 500, Math.random() * 500],
                })
            }
        }

        // every 2 seconds randomize new pos where they should go
        var an
        let aa = animate([0, 0, 1, 0, 1], function (pos) {
            for (var i = 0; i < no; i++) {
                elems[i].dom.style.transform = "scale(" + pos[2] / pos[2] + ") rotate(" + pos[3] +
                    "deg) translateX(" +
                    (elems[i].pos[0] + pos[0] + X) / pos[2] + "px) translateY(" + (elems[i].pos[1] + pos[1] + Y) /
                    pos[2] + "px) "
                elems[i].dom.style.opacity = pos[4]
            }
        })
        an = function () {
            aa.update([-200 + Math.random() * 150, Math.random() * 50, 0.5 + 2 * Math.random(), Math.random() * 18,
                Math.random()
            ])
            window.setTimeout(an, 500)
        }
        an()
        console.log("should start")

        let moving = false
        let lx = undefined,
            ly = undefined
        let start = e => {
            console.log("STARTING")
            moving = true
            lx = e.clientX
            ly = e.clientY
        }
        let move = e => {
            if (moving) {
                if (lx && ly) {
                    X += e.clientX - lx
                    Y += e.clientY - ly
                    console.log("moving", X, Y)
                }
                lx = e.clientX
                ly = e.clientY
            }
        }
        let end = e => {
            console.log("ENDING")
            moving = false
            lx = undefined
            ly = undefined
        }


        // Simple "move" with fingers to simulat that and look at performance
        let b = document.body;
        b.addEventListener("touchstart", start)
        b.addEventListener("mousedown", start)
        b.addEventListener("touchmove", move)
        b.addEventListener("mousemove", move)
        b.addEventListener("touchend", end)
        b.addEventListener("mouseup", end)
    </script>
</body>

</html>